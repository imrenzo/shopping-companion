{"version":3,"file":"index.tsx-Bj2kfA_5.js","sources":["../../src/pages/content/index.tsx"],"sourcesContent":["import { createRoot } from \"react-dom/client\";\r\nimport \"./style.css\";\r\nimport { processProduct } from \"@src/scripts/geminiProcess\";\r\n\r\nlet lastProductData: any = null;\r\n\r\n//func to wait for page to load before scraping, mainly for shopee cuz it doesn't work without waiting\r\nfunction waitForSelector(\r\n  selector: string,\r\n  timeout = 5000\r\n): Promise<Element | null> {\r\n  return new Promise((resolve) => {\r\n    const start = Date.now();\r\n    function check() {\r\n      const el = document.querySelector(selector);\r\n      //stops loop if found element or more than 5secs\r\n      if (el) return resolve(el);\r\n      if (Date.now() - start > timeout) return resolve(null);\r\n      //calls check again on next animation frame, repeatedly looping\r\n      requestAnimationFrame(check);\r\n    }\r\n    //start check loop\r\n    check();\r\n  });\r\n}\r\n\r\nasync function scrapeProductData() {\r\n  const url = window.location.hostname;\r\n  let title = \"\";\r\n  let price = \"\";\r\n\r\n  //use different selectors if on different sites (amazon, shopee, lazada)\r\n  if (url.includes(\"amazon\")) {\r\n    console.log(\"using amazon scraper\");\r\n    title = document.getElementById(\"productTitle\")?.textContent?.trim() || \"\";\r\n    price =\r\n      document.querySelector(\".a-price .a-offscreen\")?.textContent?.trim() ||\r\n      document.getElementById(\"priceblock_ourprice\")?.textContent?.trim() ||\r\n      document.getElementById(\"priceblock_dealprice\")?.textContent?.trim() ||\r\n      \"\";\r\n  } else if (url.includes(\"shopee\")) {\r\n    console.log(\"using shopee scraper\");\r\n    //shopee needs to wait for page to load otherwise won't work\r\n    const titleEl = await waitForSelector(\"h1.vR6K3w\");\r\n    const priceEl = await waitForSelector(\"div.IZPeQz.B67UQ0\");\r\n    title = titleEl?.textContent?.trim() || \"\";\r\n    price = priceEl?.textContent?.trim() || \"\";\r\n  } else if (url.includes(\"lazada\")) {\r\n    console.log(\"using lazada scraper\");\r\n    title =\r\n      document\r\n        .querySelector(\".pdp-mod-product-badge-title\")\r\n        ?.textContent?.trim() ||\r\n      document\r\n        .querySelector(\".pdp-mod-product-badge-title-v2\")\r\n        ?.textContent?.trim() ||\r\n      \"\";\r\n    price =\r\n      document\r\n        .querySelector(\".pdp-v2-product-price-content-salePrice-amount\")\r\n        ?.textContent?.trim() || \"\";\r\n    if (!price) {\r\n      const priceEl = await waitForSelector(\"span[data-spm-anchor-id]\");\r\n      price = priceEl?.textContent?.trim() || \"\";\r\n    }\r\n    price = price ? \"$\" + price : price;\r\n  } else {\r\n    // if none of the 3 sites then use generic selectors\r\n    title = document.querySelector(\"h1\")?.textContent?.trim() || \"\";\r\n    price = document.querySelector(\"[class*=price]\")?.textContent?.trim() || \"\";\r\n  }\r\n\r\n  return {\r\n    title: title || \"No product title found\",\r\n    price: price || \"No price found\",\r\n  };\r\n}\r\n\r\nasync function runScraper() {\r\n  const product = await scrapeProductData();\r\n  lastProductData = { ...product };\r\n  chrome.runtime.sendMessage({\r\n    type: \"PRODUCT_DATA\",\r\n    payload: { ...product }\r\n  });\r\n}\r\n\r\nlet lastUrl = window.location.href;\r\n\r\n//repeatedly checks every second if user navigated to another listing and then scraping if so\r\nsetInterval(() => {\r\n  if (window.location.href !== lastUrl) {\r\n    lastUrl = window.location.href;\r\n    runScraper();\r\n  }\r\n}, 1000); // Check every second (adjust as needed)\r\n\r\n//scrapes data on page load\r\nrunScraper();\r\n\r\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n  if (message.type === \"GET_PRODUCT_DATA\") {\r\n    scrapeProductData().then((product) => {\r\n      sendResponse(product);\r\n    });\r\n    return true; // Keep channel open for async response\r\n  }\r\n});\r\n\r\n"],"names":["waitForSelector","selector","timeout","resolve","start","check","el","scrapeProductData","_a","_b","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","_o","_p","_q","_r","_s","_t","_u","url","title","price","titleEl","priceEl","runScraper","product","lastUrl","message","sender","sendResponse"],"mappings":"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"}