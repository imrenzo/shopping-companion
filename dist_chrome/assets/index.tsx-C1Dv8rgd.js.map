{"version":3,"file":"index.tsx-C1Dv8rgd.js","sources":["../../src/pages/content/index.tsx"],"sourcesContent":["import { createRoot } from \"react-dom/client\";\r\nimport \"./style.css\";\r\nimport { processProduct } from \"@src/scripts/geminiProcess\";\r\n\r\nlet lastProductData: any = null;\r\n\r\n//func to wait for page to load before scraping, mainly for shopee cuz it doesn't work without waiting\r\nfunction waitForSelector(\r\n  selector: string,\r\n  timeout = 5000\r\n): Promise<Element | null> {\r\n  return new Promise((resolve) => {\r\n    const start = Date.now();\r\n    function check() {\r\n      const el = document.querySelector(selector);\r\n      //stops loop if found element or more than 5secs\r\n      if (el) return resolve(el);\r\n      if (Date.now() - start > timeout) return resolve(null);\r\n      //calls check again on next animation frame, repeatedly looping\r\n      requestAnimationFrame(check);\r\n    }\r\n    //start check loop\r\n    check();\r\n  });\r\n}\r\n\r\nasync function scrapeProductData() {\r\n  const url = window.location.hostname;\r\n  let title = \"\";\r\n  let price = \"\";\r\n\r\n  //use different selectors if on different sites (amazon, shopee, lazada)\r\n  if (url.includes(\"amazon\")) {\r\n    console.log(\"using amazon scraper\");\r\n    title = document.getElementById(\"productTitle\")?.textContent?.trim() || \"\";\r\n    price =\r\n      document.querySelector(\".a-price .a-offscreen\")?.textContent?.trim() ||\r\n      document.getElementById(\"priceblock_ourprice\")?.textContent?.trim() ||\r\n      document.getElementById(\"priceblock_dealprice\")?.textContent?.trim() ||\r\n      \"\";\r\n  } else if (url.includes(\"shopee\")) {\r\n    console.log(\"using shopee scraper\");\r\n    //shopee needs to wait for page to load otherwise won't work\r\n    const titleEl = await waitForSelector(\"h1.vR6K3w\");\r\n    const priceEl = await waitForSelector(\"div.IZPeQz.B67UQ0\");\r\n    title = titleEl?.textContent?.trim() || \"\";\r\n    price = priceEl?.textContent?.trim() || \"\";\r\n  } else if (url.includes(\"lazada\")) {\r\n    console.log(\"using lazada scraper\");\r\n    title =\r\n      document\r\n        .querySelector(\".pdp-mod-product-badge-title\")\r\n        ?.textContent?.trim() ||\r\n      document\r\n        .querySelector(\".pdp-mod-product-badge-title-v2\")\r\n        ?.textContent?.trim() ||\r\n      \"\";\r\n    price =\r\n      document\r\n        .querySelector(\".pdp-v2-product-price-content-salePrice-amount\")\r\n        ?.textContent?.trim() || \"\";\r\n    if (!price) {\r\n      const priceEl = await waitForSelector(\"span[data-spm-anchor-id]\");\r\n      price = priceEl?.textContent?.trim() || \"\";\r\n    }\r\n    price = price ? \"$\" + price : price;\r\n  } else {\r\n    // if none of the 3 sites then use generic selectors\r\n    title = document.querySelector(\"h1\")?.textContent?.trim() || \"\";\r\n    price = document.querySelector(\"[class*=price]\")?.textContent?.trim() || \"\";\r\n  }\r\n\r\n  return {\r\n    title: title || \"No product title found\",\r\n    price: price || \"No price found\",\r\n  };\r\n}\r\n\r\nconst div = document.createElement(\"div\");\r\ndiv.id = \"__root\";\r\ndocument.body.appendChild(div);\r\n\r\nconst rootContainer = document.querySelector(\"#__root\");\r\nif (!rootContainer) throw new Error(\"Can't find Content root element\");\r\nconst root = createRoot(rootContainer);\r\nroot.render(\r\n  <div className=\"absolute bottom-0 left-0 text-lg text-black bg-amber-400 z-50\">\r\n    content script <span className=\"your-class\">loaded</span>\r\n  </div>\r\n);\r\n\r\ntry {\r\n  console.log(\"content script loaded\");\r\n} catch (e) {\r\n  console.error(e);\r\n}\r\n\r\nasync function runScraper() {\r\n  const product = await scrapeProductData();\r\n  lastProductData = { ...product };\r\n  chrome.runtime.sendMessage({\r\n    type: \"PRODUCT_DATA\",\r\n    payload: { ...product }\r\n  });\r\n}\r\n\r\nlet lastUrl = window.location.href;\r\n\r\n//repeatedly checks every second if user navigated to another listing and then scraping if so\r\nsetInterval(() => {\r\n  if (window.location.href !== lastUrl) {\r\n    lastUrl = window.location.href;\r\n    runScraper();\r\n  }\r\n}, 1000); // Check every second (adjust as needed)\r\n\r\n//scrapes data on page load\r\nrunScraper();\r\n\r\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n  if (message.type === \"GET_PRODUCT_DATA\") {\r\n    scrapeProductData().then((product) => {\r\n      sendResponse(product);\r\n    });\r\n    return true; // Keep channel open for async response\r\n  }\r\n});\r\n\r\n"],"names":["waitForSelector","selector","timeout","resolve","start","check","el","scrapeProductData","url","title","price","_b","_a","_d","_c","_f","_e","_h","_g","titleEl","priceEl","_i","_j","_l","_k","_n","_m","_p","_o","_q","_s","_r","_u","_t","div","rootContainer","root","createRoot","jsxs","jsx","runScraper","product","lastUrl","message","sender","sendResponse"],"mappings":"gDAOA,SAASA,EACPC,EACAC,EAAU,IACe,CAClB,OAAA,IAAI,QAASC,GAAY,CACxB,MAAAC,EAAQ,KAAK,IAAI,EACvB,SAASC,GAAQ,CACT,MAAAC,EAAK,SAAS,cAAcL,CAAQ,EAEtC,GAAAK,EAAW,OAAAH,EAAQG,CAAE,EACzB,GAAI,KAAK,MAAQF,EAAQF,EAAS,OAAOC,EAAQ,IAAI,EAErD,sBAAsBE,CAAK,CAAA,CAGvBA,EAAA,CAAA,CACP,CACH,CAEA,eAAeE,GAAoB,+CAC3B,MAAAC,EAAM,OAAO,SAAS,SAC5B,IAAIC,EAAQ,GACRC,EAAQ,GAGR,GAAAF,EAAI,SAAS,QAAQ,EACvB,QAAQ,IAAI,sBAAsB,EAClCC,IAAQE,GAAAC,EAAA,SAAS,eAAe,cAAc,IAAtC,YAAAA,EAAyC,cAAzC,YAAAD,EAAsD,SAAU,GAEtED,IAAAG,GAAAC,EAAA,SAAS,cAAc,uBAAuB,IAA9C,YAAAA,EAAiD,cAAjD,YAAAD,EAA8D,WAC9DE,GAAAC,EAAA,SAAS,eAAe,qBAAqB,IAA7C,YAAAA,EAAgD,cAAhD,YAAAD,EAA6D,WAC7DE,GAAAC,EAAA,SAAS,eAAe,sBAAsB,IAA9C,YAAAA,EAAiD,cAAjD,YAAAD,EAA8D,SAC9D,WACOT,EAAI,SAAS,QAAQ,EAAG,CACjC,QAAQ,IAAI,sBAAsB,EAE5B,MAAAW,EAAU,MAAMnB,EAAgB,WAAW,EAC3CoB,EAAU,MAAMpB,EAAgB,mBAAmB,EACjDS,IAAAY,EAAAF,GAAA,YAAAA,EAAS,cAAT,YAAAE,EAAsB,SAAU,GAChCX,IAAAY,EAAAF,GAAA,YAAAA,EAAS,cAAT,YAAAE,EAAsB,SAAU,EAC/B,SAAAd,EAAI,SAAS,QAAQ,EAAG,CAcjC,GAbA,QAAQ,IAAI,sBAAsB,EAClCC,IACEc,GAAAC,EAAA,SACG,cAAc,8BAA8B,IAD/C,YAAAA,EAEI,cAFJ,YAAAD,EAEiB,WACjBE,GAAAC,EAAA,SACG,cAAc,iCAAiC,IADlD,YAAAA,EAEI,cAFJ,YAAAD,EAEiB,SACjB,GACFf,IACEiB,GAAAC,EAAA,SACG,cAAc,gDAAgD,IADjE,YAAAA,EAEI,cAFJ,YAAAD,EAEiB,SAAU,GACzB,CAACjB,EAAO,CACJ,MAAAU,EAAU,MAAMpB,EAAgB,0BAA0B,EACxDU,IAAAmB,EAAAT,GAAA,YAAAA,EAAS,cAAT,YAAAS,EAAsB,SAAU,EAAA,CAElCnB,EAAAA,GAAQ,IAAMA,CAAQ,MAG9BD,IAAQqB,GAAAC,EAAA,SAAS,cAAc,IAAI,IAA3B,YAAAA,EAA8B,cAA9B,YAAAD,EAA2C,SAAU,GAC7DpB,IAAQsB,GAAAC,EAAA,SAAS,cAAc,gBAAgB,IAAvC,YAAAA,EAA0C,cAA1C,YAAAD,EAAuD,SAAU,GAGpE,MAAA,CACL,MAAOvB,GAAS,yBAChB,MAAOC,GAAS,gBAClB,CACF,CAEA,MAAMwB,EAAM,SAAS,cAAc,KAAK,EACxCA,EAAI,GAAK,SACT,SAAS,KAAK,YAAYA,CAAG,EAE7B,MAAMC,EAAgB,SAAS,cAAc,SAAS,EACtD,GAAI,CAACA,EAAqB,MAAA,IAAI,MAAM,iCAAiC,EACrE,MAAMC,EAAOC,aAAWF,CAAa,EACrCC,EAAK,OACHE,EAAAA,KAAC,MAAI,CAAA,UAAU,gEAAgE,SAAA,CAAA,kBAC7DC,EAAA,IAAA,OAAA,CAAK,UAAU,aAAa,SAAM,QAAA,CAAA,CAAA,CACpD,CAAA,CACF,EAEA,GAAI,CACF,QAAQ,IAAI,uBAAuB,CACrC,OAAS,EAAG,CACV,QAAQ,MAAM,CAAC,CACjB,CAEA,eAAeC,GAAa,CACpB,MAAAC,EAAU,MAAMlC,EAAkB,GACtB,CAAE,GAAGkC,CAAQ,EAC/B,OAAO,QAAQ,YAAY,CACzB,KAAM,eACN,QAAS,CAAE,GAAGA,CAAQ,CAAA,CACvB,EACH,CAEA,IAAIC,EAAU,OAAO,SAAS,KAG9B,YAAY,IAAM,CACZ,OAAO,SAAS,OAASA,IAC3BA,EAAU,OAAO,SAAS,KACfF,EAAA,EAEf,EAAG,GAAI,EAGPA,EAAW,EAEX,OAAO,QAAQ,UAAU,YAAY,CAACG,EAASC,EAAQC,IAAiB,CAClE,GAAAF,EAAQ,OAAS,mBACD,OAAApC,EAAA,EAAE,KAAMkC,GAAY,CACpCI,EAAaJ,CAAO,CAAA,CACrB,EACM,EAEX,CAAC"}